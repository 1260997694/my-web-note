# 性能优化总述

## 思路
要进行性能优化，得知道要优化的地方在哪。从输入URL到页面展示过程，就是一条完整的线路。依照这条线路，再结合项目中的情况，就可以找出需要优化的地方并进行优化。

## 方法

### 首先讲讲输入URL到页面展示的大概过程  
一。 网络层面
1. DNS解析
2. TCP连接
3. 发送HTTP请求
4. 服务器处理请求并响应

二。浏览器层面
1. 浏览器解析数据
2. 渲染
3. 布局
4. 绘制

### 针对性优化措施  
一。 网络层面
1. 减少单次请求的时间
2. 减少网络请求次数

二。 浏览器层面

## 实战
![性能优化](https://raw.githubusercontent.com/zhiwenxuan/My_web_note/master/img/performance-optimize.jpeg
)

### Webpack性能优化

#### Webpack优化瓶颈
1. 构建时间过长（这属于开发层面的性能优化）
2. 打包结果体积太大

#### Webpack优化措施
构建速度层面：  
1. 不要loader做太多事，使用include 或者 exclude 减少没有必要的转译，比如node_mudules
2. 使用Happypack，将loader由单线程转多线程

构建体积层面：  
1. 使用Tree-Shaking，减少冗余代码
2. 按需加载
3. 开启GZip。Gzip 压缩背后的原理，是在一个文本文件中找出一些重复出现的字符串、临时替换它们，从而使整个文件变小。根据这个原理，文件中代码的重复率越高，那么压缩的效率就越高，使用 Gzip 的收益也就越大。反之亦然。

其他层面： 
1. 使用别名alias，加快查找速度，比如使用‘@’符号表示vue工程的‘src’文件夹

#### Webpack优化总结
1. 开启Gzip压缩，减少资源文件大小，从而减少单次请求的时间
2. 资源合并，减少请求次数

### 图片优化-质量与性能的博弈

#### JPG/JPEG
1. 特点
    有损压缩、体积小、加载快、不支持透明

2. 场景
    JPG 适用于呈现色彩丰富的图片，在我们日常开发中，JPG 图片经常作为大的背景图、轮播图或 Banner 图出现。  
    两大电商网站对大图的处理，是 JPG 图片应用场景的最佳写照。

3. 缺点
    拉伸模糊，不支持透明

#### PNG
1. 特点
无损压缩、质量高、体积大、支持透明

2. 场景
呈现小的 Logo、颜色简单且对比强烈的图片或背景等。

3. 缺陷
体积大

#### SVG
1.特点
文本文件、体积小、不失真、兼容性好

2. 场景
- 代码定义
- img标签引入

3. 缺陷
代码引入时需要学习成本

#### Base64
1. 特点
文本文件、依赖编码、小图标解决方案

2. 场景
一些非常小的logo文件
Base64 是作为雪碧图的补充而存在的。Base64 是一种用于传输 8Bit 字节码的编码方式，通过对图片进行 Base64 编码，我们可以直接将编码结果写入 HTML 或者写入 CSS，从而减少 HTTP 请求的次数。  



3. 缺陷
Base64 编码后，图片大小会膨胀为原文件的 4/3   
浏览器解析编码需要时间

#### WebP
1. 特点
加快图片加载速度的图片格式，它支持有损压缩和无损压缩。

2. 场景
WebP 像 JPEG 一样对细节丰富的图片信手拈来，像 PNG 一样支持透明，像 GIF 一样可以显示动态图片——它集多种图片文件格式的优点于一身。  

3. 缺陷
兼容性问题， 目前基本上只有Chrome兼容

#### IconFont
小图片上面的使用

#### 图片优化总结
1. 合理使用图片格式，减少图片资源的大小
2. 使用雪碧图，减少请求次数
3. 小图标：iconfont；小logo：Base64，SVG；颜色鲜艳logo： png；大图：JPG

### 浏览器缓存
另起文件

### 本地存储
另起文件

### CDN的缓存与回源机制解析
1. CDN定义
    *CDN （Content Delivery Network，即内容分发网络）指的是一组分布在各个地区的服务器。这些服务器存储着数据的副本，因此服务器可以根据哪些服务器与用户距离最近，来满足数据的请求。 CDN 提供快速服务，较少受高流量影响。*

2. 使用CDN原因
    提高首次响应的能力，因为缓存和本地存储只能提高已经请求过资源的响应能力。

3. CDN核心功能：缓存和回源
    “缓存”就是说我们把资源 copy 一份到 CDN 服务器上这个过程，“回源”就是说 CDN 发现自己没有这个资源（一般是缓存的数据过期了），转头向根服务器（或者它的上层服务器）去要这个资源的过程。

4. CDN使用场景
    一般用来存放静态资源，比如第三方库，jQuery

5. CDN优化细节之域名选取部分
    选取不同根服务器的域名，如淘宝域名是www.taobao.com， 而CDN服务器的域名是g.licdn.com

    好处： 静态资源不需要cookie， 域名不一样，为静态资源排除cookie的携带

### 服务端渲染（SSR）
使用场景：搜索问题（知乎）；首屏渲染要求极高的。 尽可能不用，消耗服务器性能

### 浏览器端性能优化
1. 减少回流（Reflow）和 重绘（Repaint）
2. 减少DOM操作
3. CSS文件引入放在前
4. js文件引入放在后面
5. CSS样式编写，CSS 选择符是从右到左进行匹配的
    ```css
    //错误示范
    #myList li {}

    //正确写法
    .myList_li {}
    ```
6. js引入async 和 defer正确使用
7. 异步更新Event Loop

### 实际开发案例
1. 首屏渲染-懒加载
2. 事件节流和防抖

### 性能检测工具
Performance、LightHouse 与性能 API



